/*!
 * jQuery Upload File Plugin
 * version: 4.0.11
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/ forked by @pcelta https://github.com/pcelta/jquery-upload-file
 */ !function($){void 0==$.fn.ajaxForm&&$.getScript(("https:"==document.location.protocol?"https://":"http://")+"malsup.github.io/jquery.form.js");var a={};a.fileapi=void 0!==$("<input type='file'/>").get(0).files,a.formdata=void 0!==window.FormData,$.fn.uploadFile=function(c){var b=$.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:!1,dynamicFormData:!1,maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!1,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showFileSize:!0,showProgress:!1,nestedForms:!0,showDownload:!1,onLoad:function(a){},onSelect:function(a){return!0},onSubmit:function(a,b){},onSuccess:function(a,b,c,d){},onError:function(a,b,c,d){},onCancel:function(a,b){},onAbort:function(a,b){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,serialize:!0,sequential:!1,sequentialCount:2,customProgressBar:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",uploadStr:"Upload",abortStr:"Abort",cancelStr:"Cancel",deleteStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:400,dragdropWidth:400,showPreview:!1,previewHeight:"auto",previewWidth:"100%",extraHTML:!1,uploadQueueOrder:"top",headers:{}},c);this.fileCounter=1,this.selectedFiles=0;var d="ajax-file-upload-"+new Date().getTime();this.formGroup=d,this.errorLog=$("<div></div>"),this.responses=[],this.existingFileNames=[],a.formdata||(b.dragDrop=!1),a.formdata&&1!==b.maxFileCount||(b.multiple=!1),$(this).html("");var f=this,e=$("<div>"+b.uploadStr+"</div>");$(e).addClass(b.uploadButtonClass),function c(){if($.fn.ajaxForm){if(b.dragDrop){var a=$('<div class="'+b.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(b.dragdropWidth);$(f).append(a),$(a).append(e),$(a).append($(b.dragDropStr)),k(f,b,a)}else $(f).append(e);$(f).append(f.errorLog),b.showQueueDiv?f.container=$("#"+b.showQueueDiv):f.container=$("<div class='ajax-file-upload-container'></div>").insertAfter($(f)),b.onLoad.call(this,f),s(f,d,b,e)}else window.setTimeout(c,10)}(),this.startUpload=function(){$("form").each(function(a,b){$(this).hasClass(f.formGroup)&&g.push($(this))}),g.length>=1&&j()},this.getFileCount=function(){return f.selectedFiles},this.stopUpload=function(){$("."+b.abortButtonClass).each(function(a,b){$(this).hasClass(f.formGroup)&&$(this).click()}),$("."+b.cancelButtonClass).each(function(a,b){$(this).hasClass(f.formGroup)&&$(this).click()})},this.cancelAll=function(){$("."+b.cancelButtonClass).each(function(a,b){$(this).hasClass(f.formGroup)&&$(this).click()})},this.update=function(a){b=$.extend(b,a),a.hasOwnProperty("url")&&$("form").each(function(b,c){$(this).attr("action",a.url)})},this.enqueueFile=function(a){a instanceof File&&n(b,f,[a])},this.reset=function(a){f.fileCounter=1,f.selectedFiles=0,f.errorLog.html(""),!1!=a&&f.container.html("")},this.remove=function(){f.container.html(""),$(f).remove()},this.createProgress=function(d,e,g){var a=new u(this,b);a.progressDiv.show(),a.progressbar.width("100%");var c="";return c=b.showFileCounter?f.fileCounter+b.fileCounterStyle+d:d,b.showFileSize&&(c+=" ("+l(g)+")"),a.filename.html(c),f.fileCounter++,f.selectedFiles++,b.showPreview&&(a.preview.attr("src",e),a.preview.show()),b.showDownload&&(a.download.show(),a.download.click(function(){b.downloadCallback&&b.downloadCallback.call(f,[d],a)})),b.showDelete&&(a.del.show(),a.del.click(function(){b.deleteCallback&&b.deleteCallback.call(this,[d],a),f.selectedFiles-=1,r(b,f)})),a},this.getResponses=function(){return this.responses};var g=[],h=[],i=!1;function j(){i||(i=!0,function c(){if(b.sequential||(b.sequentialCount=99999),0==g.length&&0==h.length)b.afterUploadAll&&b.afterUploadAll(f),i=!1;else{if(h.length<b.sequentialCount){var a=g.shift();void 0!=a&&(h.push(a),a.removeClass(f.formGroup),a.submit())}window.setTimeout(c,100)}}())}function k(b,c,a){a.on("dragenter",function(a){a.stopPropagation(),a.preventDefault(),$(this).addClass(c.dragDropHoverClass)}),a.on("dragover",function(b){b.stopPropagation(),b.preventDefault();var a=$(this);a.hasClass(c.dragDropContainerClass)&&!a.hasClass(c.dragDropHoverClass)&&a.addClass(c.dragDropHoverClass)}),a.on("drop",function(d){d.preventDefault(),$(this).removeClass(c.dragDropHoverClass),b.errorLog.html("");var a=d.originalEvent.dataTransfer.files;if(!c.multiple&&a.length>1){c.showError&&$("<div class='"+c.errorClass+"'>"+c.multiDragErrorStr+"</div>").appendTo(b.errorLog);return}!1!=c.onSelect(a)&&n(c,b,a)}),a.on("dragleave",function(a){$(this).removeClass(c.dragDropHoverClass)}),$(document).on("dragenter",function(a){a.stopPropagation(),a.preventDefault()}),$(document).on("dragover",function(a){a.stopPropagation(),a.preventDefault();var b=$(this);b.hasClass(c.dragDropContainerClass)||b.removeClass(c.dragDropHoverClass)}),$(document).on("drop",function(a){a.stopPropagation(),a.preventDefault(),$(this).removeClass(c.dragDropHoverClass)})}function l(b){var c="",a=b/1024;return parseInt(a)>1024?(a/1024).toFixed(2)+" MB":a.toFixed(2)+" KB"}function m(c){var a,d,b=[],f=(b="string"==jQuery.type(c)?c.split("&"):$.param(c).split("&")).length,e=[];for(a=0;a<f;a++)b[a]=b[a].replace(/\+/g," "),d=b[a].split("="),e.push([decodeURIComponent(d[0]),decodeURIComponent(d[1])]);return e}function n(a,d,c){for(var b=0;b<c.length;b++){if(!o(d,a,c[b].name)){a.showError&&$("<div class='"+a.errorClass+"'><b>"+c[b].name+"</b> "+a.extErrorStr+a.allowedTypes+"</div>").appendTo(d.errorLog);continue}if(!a.allowDuplicates&&p(d,c[b].name)){a.showError&&$("<div class='"+a.errorClass+"'><b>"+c[b].name+"</b> "+a.duplicateErrorStr+"</div>").appendTo(d.errorLog);continue}if(-1!=a.maxFileSize&&c[b].size>a.maxFileSize){a.showError&&$("<div class='"+a.errorClass+"'><b>"+c[b].name+"</b> "+a.sizeErrorStr+l(a.maxFileSize)+"</div>").appendTo(d.errorLog);continue}if(-1!=a.maxFileCount&&d.selectedFiles>=a.maxFileCount){a.showError&&$("<div class='"+a.errorClass+"'><b>"+c[b].name+"</b> "+a.maxFileCountErrorStr+a.maxFileCount+"</div>").appendTo(d.errorLog);continue}d.selectedFiles++,d.existingFileNames.push(c[b].name);var i=$.extend({},a),g=new FormData,r=a.fileName.replace("[]","");g.append(r,c[b]);var j=a.formData;if(j)for(var f=m(j),e=0;e<f.length;e++)f[e]&&g.append(f[e][0],f[e][1]);i.fileData=g;var k=new u(d,a),h="";h=a.showFileCounter?d.fileCounter+a.fileCounterStyle+c[b].name:c[b].name,a.showFileSize&&(h+=" ("+l(c[b].size)+")"),k.filename.html(h);var n=$("<form style='display:block; position:absolute;left: 150px;' class='"+d.formGroup+"' method='"+a.method+"' action='"+a.url+"' enctype='"+a.enctype+"'></form>");n.appendTo("body");var q=[];q.push(c[b].name),v(n,i,k,q,d,c[b]),d.fileCounter++}}function o(e,a,b){var c=a.allowedTypes.toLowerCase().split(/[\s,]+/g),d=b.split(".").pop().toLowerCase();return!("*"!=a.allowedTypes&&0>jQuery.inArray(d,c))}function p(a,d){var e=!1;if(a.existingFileNames.length)for(var c=0;c<a.existingFileNames.length;c++)(a.existingFileNames[c]==d||b.duplicateStrict&&a.existingFileNames[c].toLowerCase()==d.toLowerCase())&&(e=!0);return e}function q(a,c){if(a.existingFileNames.length)for(var b=0;b<c.length;b++){var d=a.existingFileNames.indexOf(c[b]);-1!=d&&a.existingFileNames.splice(d,1)}}function r(b,a){if(b.showFileCounter){var c=$(a.container).find(".ajax-file-upload-filename").length;a.fileCounter=c+1,$(a.container).find(".ajax-file-upload-filename").each(function(e,f){var a=$(this).html().split(b.fileCounterStyle);parseInt(a[0]);var d=c+b.fileCounterStyle+a[1];$(this).html(d),c--})}}function s(h,i,b,d){var e="ajax-upload-id-"+new Date().getTime(),c=$("<form method='"+b.method+"' action='"+b.url+"' enctype='"+b.enctype+"'></form>"),f="<input type='file' id='"+e+"' name='"+b.fileName+"' accept='"+b.acceptFiles+"'/>";b.multiple&&(b.fileName.indexOf("[]")!=b.fileName.length-2&&(b.fileName+="[]"),f="<input type='file' id='"+e+"' name='"+b.fileName+"' accept='"+b.acceptFiles+"' multiple/>");var g=$(f).appendTo(c);g.change(function(){h.errorLog.html(""),b.allowedTypes.toLowerCase().split(",");var e=[];if(this.files){for(j=0;j<this.files.length;j++)e.push(this.files[j].name);if(!1==b.onSelect(this.files))return}else{var f=$(this).val(),k=[];if(e.push(f),!o(h,b,f)){b.showError&&$("<div class='"+b.errorClass+"'><b>"+f+"</b> "+b.extErrorStr+b.allowedTypes+"</div>").appendTo(h.errorLog);return}if(k.push({name:f,size:"NA"}),!1==b.onSelect(k))return}if(r(b,h),d.unbind("click"),c.hide(),s(h,i,b,d),c.addClass(i),b.serialize&&a.fileapi&&a.formdata){c.removeClass(i);var m=this.files;c.remove(),n(b,h,m)}else{for(var g="",j=0;j<e.length;j++)b.showFileCounter?g+=h.fileCounter+b.fileCounterStyle+e[j]+"<br>":g+=e[j]+"<br>",h.fileCounter++;if(-1!=b.maxFileCount&&h.selectedFiles+e.length>b.maxFileCount){b.showError&&$("<div class='"+b.errorClass+"'><b>"+g+"</b> "+b.maxFileCountErrorStr+b.maxFileCount+"</div>").appendTo(h.errorLog);return}h.selectedFiles+=e.length;var l=new u(h,b);l.filename.html(g),v(c,b,l,e,h,null)}}),b.nestedForms?(c.css({margin:0,padding:0}),d.css({position:"relative",overflow:"hidden",cursor:"default"}),g.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),c.appendTo(d)):(c.appendTo($("body")),c.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"}),-1!=navigator.appVersion.indexOf("MSIE ")?d.attr("for",e):d.click(function(){g.click()}))}function t(b,a){return this.statusbar=$("<div class='ajax-file-upload-statusbar'></div>").width(a.statusBarWidth),this.preview=$("<img class='ajax-file-upload-preview' />").width(a.previewWidth).height(a.previewHeight).appendTo(this.statusbar).hide(),this.filename=$("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=$("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=$("<div class='ajax-file-upload-bar'></div>").appendTo(this.progressDiv),this.abort=$("<div>"+a.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=$("<div>"+a.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=$("<div>"+a.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=$("<div>"+a.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=$("<div>"+a.deleteStr+"</div>").appendTo(this.statusbar).hide(),this.abort.addClass("ajax-file-upload-red"),this.done.addClass("ajax-file-upload-green"),this.download.addClass("ajax-file-upload-green"),this.cancel.addClass("ajax-file-upload-red"),this.del.addClass("ajax-file-upload-red"),this}function u(c,a){var b=null;return(b=a.customProgressBar?new a.customProgressBar(c,a):new t(c,a)).abort.addClass(c.formGroup),b.abort.addClass(a.abortButtonClass),b.cancel.addClass(c.formGroup),b.cancel.addClass(a.cancelButtonClass),a.extraHTML&&(b.extraHTML=$("<div class='extrahtml'>"+a.extraHTML()+"</div>").insertAfter(b.filename)),"bottom"==a.uploadQueueOrder?$(c.container).append(b.statusbar):$(c.container).prepend(b.statusbar),b}function v(c,b,d,i,k,e){var f={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:b.method,data:b.formData,formData:b.fileData,dataType:b.returnType,headers:b.headers,beforeSubmit:function(h,j,f){if(!1!=b.onSubmit.call(this,i)){if(b.dynamicFormData){var a=m(b.dynamicFormData());if(a)for(var e=0;e<a.length;e++)a[e]&&(b.serialize&& void 0!=b.fileData?f.formData.append(a[e][0],a[e][1]):f.data[a[e][0]]=a[e][1])}return b.extraHTML&&$(d.extraHTML).find("input,select,textarea").each(function(a,c){b.serialize&& void 0!=b.fileData?f.formData.append($(this).attr("name"),$(this).val()):f.data[$(this).attr("name")]=$(this).val()}),!0}return d.statusbar.append("<div class='"+b.errorClass+"'>"+b.uploadErrorStr+"</div>"),d.cancel.show(),c.remove(),d.cancel.click(function(){g.splice(g.indexOf(c),1),q(k,i),d.statusbar.remove(),b.onCancel.call(k,i,d),k.selectedFiles-=i.length,r(b,k)}),!1},beforeSend:function(f,c){for(var e in c.headers)f.setRequestHeader(e,c.headers[e]);d.progressDiv.show(),d.cancel.hide(),d.done.hide(),b.showAbort&&(d.abort.show(),d.abort.click(function(){q(k,i),f.abort(),k.selectedFiles-=i.length,b.onAbort.call(k,i,d)})),a.formdata?d.progressbar.width("1%"):d.progressbar.width("5%")},uploadProgress:function(e,f,g,a){a>98&&(a=98);var c=a+"%";a>1&&d.progressbar.width(c),b.showProgress&&(d.progressbar.html(c),d.progressbar.css("text-align","center"))},success:function(a,g,f){if(d.cancel.remove(),h.pop(),"json"==b.returnType&&"object"==$.type(a)&&a.hasOwnProperty(b.customErrorKeyStr)){d.abort.hide();var e=a[b.customErrorKeyStr];b.onError.call(this,i,200,e,d),b.showStatusAfterError?(d.progressDiv.hide(),d.statusbar.append("<span class='"+b.errorClass+"'>ERROR: "+e+"</span>")):(d.statusbar.hide(),d.statusbar.remove()),k.selectedFiles-=i.length,c.remove();return}k.responses.push(a),d.progressbar.width("100%"),b.showProgress&&(d.progressbar.html("100%"),d.progressbar.css("text-align","center")),d.abort.hide(),b.onSuccess.call(this,i,a,f,d),b.showStatusAfterSuccess?(b.showDone?(d.done.show(),d.done.click(function(){d.statusbar.hide("slow"),d.statusbar.remove()})):d.done.hide(),b.showDelete?(d.del.show(),d.del.click(function(){q(k,i),b.deleteCallback&&b.deleteCallback.call(this,a,d),k.selectedFiles-=i.length,r(b,k)})):d.del.hide()):(d.statusbar.hide("slow"),d.statusbar.remove()),b.showDownload&&(d.download.show(),d.download.click(function(){b.downloadCallback&&b.downloadCallback(a,d)})),c.remove()},error:function(e,f,a){d.cancel.remove(),h.pop(),d.abort.hide(),"abort"==e.statusText?(d.statusbar.hide("slow").remove(),r(b,k)):(b.onError.call(this,i,f,a,d),b.showStatusAfterError?(d.progressDiv.hide(),d.statusbar.append("<span class='"+b.errorClass+"'>ERROR: "+a+"</span>")):(d.statusbar.hide(),d.statusbar.remove()),k.selectedFiles-=i.length),c.remove()}};b.showPreview&&null!=e&&"image"==e.type.toLowerCase().split("/").shift()&&function(a,c){if(a){c.show();var b=new FileReader;b.onload=function(a){c.attr("src",a.target.result)},b.readAsDataURL(a)}}(e,d.preview),b.autoSubmit?(c.ajaxForm(f),g.push(c),j()):(b.showCancel&&(d.cancel.show(),d.cancel.click(function(){g.splice(g.indexOf(c),1),q(k,i),c.remove(),d.statusbar.remove(),b.onCancel.call(k,i,d),k.selectedFiles-=i.length,r(b,k)})),c.ajaxForm(f))}return this}}(jQuery)